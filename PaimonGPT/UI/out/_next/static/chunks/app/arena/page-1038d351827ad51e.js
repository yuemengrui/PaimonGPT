(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3107],{50372:function(e,r,t){Promise.resolve().then(t.bind(t,3757))},18039:function(e,r,t){"use strict";t.d(r,{B:function(){return n}});var s=t(13650);async function n(){let e={method:"GET",headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("Authorization")}},r=await (0,s.d)("/ai/llm/list",e);return(console.log("llm list response",r),r)?r.data:[]}},13650:function(e,r,t){"use strict";async function s(e,r){let t=await fetch(e,r);return await t.json()}t.d(r,{d:function(){return s}})},3757:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return L}});var s=t(57437),n=t(51791),a=t(98386),l=t(93628),o=t(2265),i=t(15982),c=t(10056),d=t(22043),x=t(52736),m=t(17885),h=t(97464),u=t(32527),g=t(26621),p=t(30954),j=t(76526),f=t(72647),v=t(3391),b=t(81629),y=t(4159),w=t(59322),_=t(14348),k=t(88610),N=t(71504),S=t(89348),Z=t(45470),T=t(72279),z=t(88920),C=t(5618),E=t(5523),A=t(19734),O=t(32376),W=t(85686),M=t(16691),D=t.n(M),H=t(32721),I=t(211),P=t(77267),G=t(37600),K=t(18039),R=t(73623);function F(){let e=(0,R.p)(),[r,t]=(0,o.useState)(""),[n,a]=(0,o.useState)([]),[l,M]=(0,o.useState)([]),F=(0,o.useRef)(null),[L,$]=(0,o.useState)(!1),[B,J]=(0,o.useState)(null),[Q,U]=(0,o.useState)(0),[V,q]=(0,o.useState)(!1),[X,Y]=(0,o.useState)(0),[ee,er]=(0,o.useState)(!1);async function et(){let e={id:(0,C.Z)(),role:"user",type:"text",content:r};for(let s of(t(""),a(r=>[...r,e]),l)){let e={id:(0,C.Z)(),role:"assistant",model_name:s.model_name,score:0,type:"text",content:"正在思考中...",response:{}};a(r=>[...r,e]),await (0,E.L)("/ai/llm/chat/simple",{openWhenHidden:!0,method:"POST",headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("Authorization")},body:JSON.stringify({prompt:r,model_name:s.model_name}),onmessage(r){try{let t=JSON.parse(r.data);a(r=>[...r.slice(0,-1),{id:e.id,role:e.role,model_name:s.model_name,score:0,type:"text",content:t.answer,response:t}])}catch(e){console.log(e)}},onerror(r){throw a(r=>[...r.slice(0,-1),{id:e.id,role:e.role,model_name:s.model_name,score:0,type:"text",content:"抱歉！服务繁忙！请稍后重试！",response:{}}]),r}})}Y(X+1)}async function es(r){"clipboard"in navigator?await navigator.clipboard.writeText(r):document.execCommand("copy",!0,r),e({title:"复制成功",status:"success",position:"top",duration:2e3})}return(0,o.useEffect)(()=>{(async function(){let e=await (0,K.B)();e&&e.length>0&&M(e.map(e=>({...e,avgScore:0,avgGenerationTime:0,avgTokens:0,avgSpeed:0})))})()},[]),(0,o.useEffect)(()=>{F.current&&(F.current.scrollTop=F.current.scrollHeight),!1===ee&&n.filter(e=>"user"===e.role).length>9&&er(!0)},[n]),(0,o.useEffect)(()=>{!function(){let e=[];for(let r of l){let t=n.filter(e=>"assistant"===e.role&&e.model_name===r.model_name),s=t.reduce((e,r)=>e+r.score,0),a=t.reduce((e,r)=>e+parseFloat(r.response.time_cost.generation),0),l=t.reduce((e,r)=>e+r.response.usage.total_tokens,0),o=t.reduce((e,r)=>e+parseFloat(r.response.usage.average_speed),0);e.push({model_name:r.model_name,avgScore:Math.round(s/t.length*100)/100,avgGenerationTime:Math.round(a/t.length*100)/100,avgTokens:Math.round(l/t.length*100)/100,avgSpeed:Math.round(o/t.length*100)/100})}e.sort((e,r)=>r.avgScore-e.avgScore),M(e)}()},[X]),(0,s.jsxs)("div",{className:"flex h-full relative",children:[(0,s.jsxs)("div",{className:"w-[500px] items-center text-center",children:[(0,s.jsx)("div",{className:"text-2xl mt-2",children:"排行榜"}),ee?(0,s.jsx)("div",{children:(0,s.jsx)(i.x,{mt:6,children:(0,s.jsxs)(c.i,{fontSize:"xs",children:[(0,s.jsx)(d.h,{children:(0,s.jsxs)(x.Tr,{children:[(0,s.jsx)(m.Th,{children:"模型名"}),(0,s.jsx)(m.Th,{maxW:"88px",children:"平均token数"}),(0,s.jsx)(m.Th,{maxW:"88px",children:"平均生成时间"}),(0,s.jsx)(m.Th,{maxW:"88px",children:"平均生成速度"}),(0,s.jsx)(m.Th,{maxW:"20px",children:"平均分"})]})}),(0,s.jsx)(h.p,{children:l.map(e=>(0,s.jsxs)(x.Tr,{cursor:"pointer",_hover:{bg:"blue.50"},children:[(0,s.jsx)(u.Td,{maxW:"130px",children:e.model_name}),(0,s.jsx)(u.Td,{children:e.avgTokens}),(0,s.jsx)(u.Td,{children:e.avgGenerationTime+" s"}),(0,s.jsx)(u.Td,{children:e.avgSpeed+" token/s"}),(0,s.jsx)(u.Td,{children:e.avgScore})]},e.model_name))})]})})}):(0,s.jsxs)("div",{className:"mt-24",children:[(0,s.jsx)("div",{children:"请在右边提问，并对回答进行打分"}),(0,s.jsx)("div",{className:"mt-6",children:"问答次数达到10次才会显示排行榜信息"})]})]}),(0,s.jsx)("div",{className:"w-[1px] h-full bg-gray-200"}),(0,s.jsxs)("div",{className:"w-full relative",children:[(0,s.jsx)("div",{className:"w-full max-w-4xl mx-auto",children:(0,s.jsx)("ul",{ref:F,style:{maxHeight:"calc(100vh - 200px)"},className:"overflow-auto",children:n.map(e=>{let r="assistant"===e.role;return(0,s.jsxs)("li",{className:"".concat(r?"justify-start":"justify-end"," w-full max-w-4xl mx-auto flex space-x-6 px-4 py-6"),children:["user"===e.role&&(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{children:(0,s.jsxs)(g.k,{gap:3,w:"100%",alignItems:"center",justifyContent:"flex-end",children:["text"===e.type&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(A.Z,{label:"复制",children:(0,s.jsx)(O.Z,{onClick:()=>es(e.content),children:(0,s.jsx)(W.pDe,{})})})}),(0,s.jsx)("div",{className:"text-3xl shadow-[0_0_1px_1px_rgba(0,0,0,0.2)] bg-white border rounded-lg border-gray-100",children:"\uD83D\uDE0A"})]})}),"image"===e.type?(0,s.jsx)(D(),{src:e.url,alt:"image",width:e.width||600,height:e.height||600}):(0,s.jsx)("div",{className:"bg-blue-100 rounded-lg shadow-[0_2px_2px_2px_rgba(96,165,250,0.3)] text-sm mt-3 text-right px-2 py-2 max-w-fit ml-auto",children:(0,s.jsx)(H.Z,{children:e.content})})]}),"assistant"===e.role&&(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{children:(0,s.jsxs)(g.k,{gap:3,w:"100%",alignItems:"center",justifyContent:"flex-start",children:[(0,s.jsx)("div",{className:"text-3xl bg-white border rounded-lg border-gray-100 shadow-[0_0_1px_1px_rgba(0,0,0,0.2)]",children:(0,s.jsx)(I.Cp6,{})}),(0,s.jsx)(A.Z,{label:"复制",children:(0,s.jsx)(O.Z,{onClick:()=>es(e.content),children:(0,s.jsx)(W.pDe,{})})}),(0,s.jsx)(A.Z,{label:0===e.score?"给本次回答打个分":e.score+" 分",children:(0,s.jsx)(O.Z,{onClick:()=>{var r,t;return r=e.id,t=e.score,void(J(r),U(t),$(!0))},children:0===e.score?(0,s.jsx)(P.Q$h,{}):(0,s.jsx)(g.k,{children:Array.from({length:e.score},(e,r)=>(0,s.jsx)(P.Q$h,{className:"text-red-600"},r))})})})]})}),(0,s.jsxs)("div",{className:"bg-pink-100 rounded-lg shadow-[0_2px_2px_2px_rgba(244,114,182,0.3)] text-sm mt-3 px-2 py-2",children:[(0,s.jsx)(H.Z,{children:e.content}),ee&&(0,s.jsxs)(g.k,{alignItems:"center",mt:"4",flexWrap:"wrap",gap:"2",children:[(0,s.jsx)(A.Z,{label:"本次请求总共使用的token数量",children:(0,s.jsx)(G.Z,{text:"".concat(e.response.usage?e.response.usage.total_tokens:0," tokens")})}),(0,s.jsx)(A.Z,{label:"本次请求所用时间",children:(0,s.jsx)(G.Z,{text:"".concat(e.response.time_cost?e.response.time_cost.total:"0s")})}),(0,s.jsx)(A.Z,{label:"模型名称",children:(0,s.jsx)(G.Z,{text:e.model_name})})]})]})]})]},e.id)})})}),(0,s.jsx)("div",{className:"absolute bottom-6 inset-x-0",children:(0,s.jsx)("div",{className:"w-full max-w-4xl mx-auto flex flex-col items-center px-4 space-y-4",children:(0,s.jsxs)("div",{className:"flex items-end w-full border border-back/10 bg-blue-100 rounded-lg shadow-[0_0_15px_rgba(0,0,0,0.1)] py-2",children:[(0,s.jsx)("div",{className:"mx-3 mb-2.5",children:(0,s.jsx)(S.RHh,{})}),(0,s.jsx)(Z.Z,{className:"outline-none flex-1 max-h-64 mb-1.5 bg-transparent text-black resize-none border-0",placeholder:"输入一条消息...",rows:1,value:r,onKeyDown:function(e){e.metaKey&&"Enter"===e.code?t(r+"\n"):"Enter"===e.code&&r&&et()},onChange:e=>{"\n"!==e.target.value&&t(e.target.value)}}),(0,s.jsx)(T.Z,{className:"mx-3 !rounded-lg text-blue-500",icon:z.LbG,disabled:""===r.trim(),variant:"primary",onClick:et})]})})})]}),L&&(0,s.jsxs)(p.u_,{isOpen:!0,onClose:()=>$(!1),children:[(0,s.jsx)(j.Z,{}),(0,s.jsxs)(f.h,{children:[(0,s.jsx)(v.x,{children:"请打分"}),(0,s.jsx)(b.o,{}),(0,s.jsxs)(y.f,{children:[(0,s.jsx)("div",{className:"px-6",children:(0,s.jsxs)(w.iR,{id:"slider",defaultValue:Q,min:0,max:5,step:1,colorScheme:"red",onChange:e=>U(e),onMouseEnter:()=>q(!0),onMouseLeave:()=>q(!1),children:[(0,s.jsx)(w.jz,{value:0,mt:"1",fontSize:"sm",ml:"-0.5",color:"red.100",children:"0"}),(0,s.jsx)(w.jz,{value:1,mt:"1",fontSize:"sm",ml:"-0.5",color:"red.200",children:"1"}),(0,s.jsx)(w.jz,{value:2,mt:"1",fontSize:"sm",ml:"-0.5",color:"red.300",children:"2"}),(0,s.jsx)(w.jz,{value:3,mt:"1",fontSize:"sm",ml:"-0.5",color:"red.400",children:"3"}),(0,s.jsx)(w.jz,{value:4,mt:"1",fontSize:"sm",ml:"-0.5",color:"red.500",children:"4"}),(0,s.jsx)(w.jz,{value:5,mt:"1",fontSize:"sm",ml:"-0.5",color:"red.600",children:"5"}),(0,s.jsx)(w.Uj,{children:(0,s.jsx)(w.Ms,{})}),(0,s.jsx)(_.u,{hasArrow:!0,bg:"blue.300",color:"white",placement:"top",isOpen:V,label:"".concat(Q," 分"),children:(0,s.jsx)(w.gs,{})})]})}),(0,s.jsx)("div",{className:"px-8 mt-12 text-sm text-gray-600",children:"分数越高表示回答质量越高，0分表示回答质量很差，5分表示回答质量很好"})]}),(0,s.jsx)(k.m,{children:(0,s.jsx)(N.z,{border:"1px",borderColor:"gray.200",onClick:function(){a(n.map(e=>e.id===B?{...e,score:Q}:e)),J(null),Y(X+1),$(!1)},children:"确认"})})]})]})]})}function L(){let[e,r]=(0,o.useState)(0);return(0,s.jsx)("div",{className:"flex h-full",style:{maxHeight:"calc(100vh - 60px)",minHeight:"calc(100vh - 76px)"},children:(0,s.jsxs)("div",{className:"flex flex-1 flex-col bg-white border border-gray-200 rounded-3xl mt-1 mr-2 ml-2 mb-1",children:[(0,s.jsx)("div",{className:"w-full h-[48px]",children:(0,s.jsx)(n.m,{mt:2,mb:2,size:"sm",align:"center",variant:"soft-rounded",colorScheme:"pink",defaultIndex:0,onChange:e=>r(e),children:(0,s.jsx)(a.t,{children:[{id:0,name:"大模型 PK"},{id:1,name:"Embedding检索 PK"}].map(e=>(0,s.jsx)(l.O,{children:e.name},e.id))})})}),(0,s.jsx)("div",{className:"w-full h-[1px] bg-gray-200"}),0===e&&(0,s.jsx)(F,{}),1===e&&(0,s.jsx)("div",{className:"text-center mt-24 text-6xl",children:"coming soon"})]})})}},32376:function(e,r,t){"use strict";var s=t(57437);t(2265),r.Z=e=>{let{children:r,...t}=e;return(0,s.jsx)("div",{className:"bg-gray-50 border rounded-lg border-gray-100 shadow-[0_0_1px_1px_rgba(0,0,0,0.1)] px-0.5 py-0.5 hover:bg-orange-50 hover:text-red-400",...t,children:r})}},37600:function(e,r,t){"use strict";var s=t(57437);t(2265),r.Z=e=>{let{text:r,...t}=e;return(0,s.jsx)("div",{className:"rounded border border-solid border-red-400 text-red-400 text-center text-xs px-1.5 py-0.5",...t,children:r})}},19734:function(e,r,t){"use strict";var s=t(57437);t(2265);var n=t(14348);r.Z=e=>{let{children:r,shouldWrapChildren:t=!0,...a}=e;return(0,s.jsx)(n.u,{fontSize:12,bg:"white",arrowShadowColor:"rgba(0,0,0,0.02)",hasArrow:!0,arrowSize:12,offset:[-15,15],color:"gray.900",px:3,py:2,borderRadius:"8px",whiteSpace:"pre-wrap",boxShadow:"2px 2px 10px rgba(0,0,0,0.2)",shouldWrapChildren:t,...a,children:r})}},32721:function(e,r,t){"use strict";var s=t(57437),n=t(2265),a=t(49236),l=t(98809),o=t(73621),i=t(95462);r.Z=(0,n.memo)(function(e){let{children:r,className:t="",...n}=e;return(0,s.jsx)(a.U,{components:{code(e){var r;let{node:t,inline:n,className:a,children:l,...c}=e,d=/language-(\w+)/.exec(a||"");return n?(0,s.jsx)("code",{...c,className:a,children:l}):(0,s.jsx)(o.Z,{...c,style:i.Z,language:null!==(r=null==d?void 0:d[1])&&void 0!==r?r:"",PreTag:"div",children:String(l).replace(/\n$/,"")})}},remarkPlugins:[l.Z],className:"whitespace-pre-wrap markdown prose dark:prose-invert ".concat(t),...n,children:r})})},72279:function(e,r,t){"use strict";t.d(r,{Z:function(){return n}});var s=t(57437);function n(e){let{children:r,className:t="",icon:n,variant:a="default",...l}=e;return(0,s.jsxs)("button",{className:"inline-flex items-center min-w-[38px] min-h-[38px] rounded px-3 py-1.5\n            ".concat("default"===a?"text-gray-600 dark:text-gray-300 bg-gray-50 hover:bg-blue-100 dark:bg-gray-700 dark:hover:bg-gray-900":"outline"===a?"border border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300 bg-gray-50 hover:bg-gray-200 dark:bg-gray-800 dark:hover:bg-gray-700":"primary"===a?"bg-primary-500 text-gray-200 hover:bg-primary-600 hover:text-blue-600":"text-black dark:text-gray-300 bg-transparent hover:bg-gray-200 dark:hover:bg-gray-700","\n            ").concat(t),...l,children:[n&&(0,s.jsx)(n,{className:"text-lg ".concat(r?"mr-1":"")}),r]})}}},function(e){e.O(0,[6281,6169,5104,6682,6161,8071,5379,2323,9034,9322,2971,4938,1744],function(){return e(e.s=50372)}),_N_E=e.O()}]);