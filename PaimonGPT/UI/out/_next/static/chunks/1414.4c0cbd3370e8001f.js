(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1414],{42480:function(){},81684:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return Q}});var s=t(57437),n=t(2265),a=t(81768),l=t(65328),i=t(73623),o=t(6806),c=t(37600),d=t(26621),x=t(5618),u=t(32721),h=t(211),p=t(71504),m=t(19734),g=t(85686),j=t(19241),b=t(24606),f=t(41697),y=t(77267),v=t(32376),w=t(30954),_=t(76526),k=t(72647),Z=t(3391),C=t(81629),N=t(4159),S=t(88610),I=t(58491);t(10905);var E=t(16691),P=t.n(E),R=t(82466),z=t(44155),T=t.n(z);let A=R.N.mermaidAPI;A.initialize({startOnLoad:!0,theme:"base",flowchart:{htmlLabels:!1,useMaxWidth:!1},themeVariables:{fontSize:"14px",primaryColor:"#d6e8ff",primaryTextColor:"#485058",primaryBorderColor:"#fff",lineColor:"#5A646E",secondaryColor:"#B5E9E5",tertiaryColor:"#485058"}});let D=n.forwardRef((e,r)=>{let[t,a]=(0,n.useState)(null),l=(0,n.useRef)("flowchart_".concat(T().MD5(e.PrimitiveCode).toString())),[i,o]=(0,n.useState)(!0),c=()=>{for(let e=localStorage.length-1;e>=0;--e){let r=localStorage.key(e);r&&r.startsWith("flowchart_")&&localStorage.removeItem(r)}},d=async e=>{try{let r=localStorage.getItem(l.current);if(r){a(r);return}if(A){let r=await A.render(l.current,e),t=await x(r.svg);a(t),l.current&&t&&localStorage.setItem(l.current,t)}}catch(e){c(),u()}},x=e=>{let r=new TextEncoder().encode(e),t=new Blob([r],{type:"image/svg+xml;charset=utf-8"});return new Promise((e,r)=>{let s=new FileReader;s.onloadend=()=>e(s.result),s.onerror=r,s.readAsDataURL(t)})},u=()=>{o(!1),a(null),l.current&&localStorage.removeItem(l.current),setTimeout(()=>{o(!0),d(e.PrimitiveCode)},100)};return(0,n.useEffect)(()=>{o(!1),setTimeout(()=>{o(!0),d(e.PrimitiveCode)},100)},[e.PrimitiveCode]),(0,s.jsx)("div",{ref:r,children:i&&(0,s.jsx)("div",{id:l.current,className:"mermaid",children:t&&(0,s.jsx)("img",{src:t,alt:"Mermaid chart"})})})});function M(e){let{messageList:r,stream_generate:t,waitingReply:a}=e,l=(0,i.p)(),[o,x]=(0,n.useState)(!1),[E,z]=(0,n.useState)({}),[T,A]=(0,n.useState)(!1),M=(0,n.useRef)(null),[L,O]=(0,n.useState)(!1),[H,Q]=(0,n.useState)("");async function W(e){"clipboard"in navigator?await navigator.clipboard.writeText(e):document.execCommand("copy",!0,e),l({title:"复制成功",status:"success",position:"top",duration:2e3})}function B(){A(!0)}return(0,n.useEffect)(()=>{M.current&&(M.current.scrollTop=M.current.scrollHeight)},[r]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"w-full mx-auto",children:(0,s.jsx)("ul",{ref:M,style:{maxHeight:"calc(100vh - 230px)"},className:"overflow-auto",children:r.map(e=>{let r="assistant"===e.role;return(0,s.jsxs)("li",{className:"".concat(r?"justify-start":"justify-end"," w-full mx-auto flex space-x-6 px-6 py-6"),children:["user"===e.role&&(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{children:(0,s.jsxs)(d.k,{gap:3,w:"100%",alignItems:"center",justifyContent:"flex-end",children:["text"===e.type&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(m.Z,{label:"复制",children:(0,s.jsx)(v.Z,{onClick:()=>W(e.content),children:(0,s.jsx)(g.pDe,{})})}),(0,s.jsx)(m.Z,{label:"重新生成",children:(0,s.jsx)(v.Z,{onClick:()=>t(e.content),children:(0,s.jsx)(b.cAs,{})})})]}),(0,s.jsx)(m.Z,{label:"删除",children:(0,s.jsx)(v.Z,{children:(0,s.jsx)(j.qy0,{})})}),(0,s.jsx)("div",{className:"text-3xl shadow-[0_0_1px_1px_rgba(0,0,0,0.2)] bg-white border rounded-lg border-gray-100",children:"\uD83D\uDE0A"})]})}),"image"===e.type?(0,s.jsx)(P(),{src:e.url,alt:"image",width:e.width||600,height:e.height||600}):(0,s.jsx)("div",{className:"bg-blue-100 rounded-lg shadow-[0_2px_2px_2px_rgba(96,165,250,0.3)] text-sm mt-3 text-right px-2 py-2 max-w-fit ml-auto",children:(0,s.jsx)(u.Z,{children:e.content})})]}),"assistant"===e.role&&(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{children:(0,s.jsxs)(d.k,{gap:3,w:"100%",alignItems:"center",justifyContent:"flex-start",children:[(0,s.jsx)("div",{className:"text-3xl bg-white border rounded-lg border-gray-100 shadow-[0_0_1px_1px_rgba(0,0,0,0.2)]",children:(0,s.jsx)(h.Cp6,{className:a?"animate-spin":""})}),(0,s.jsx)(m.Z,{label:"复制",children:(0,s.jsx)(v.Z,{onClick:()=>W(e.content),children:(0,s.jsx)(g.pDe,{})})}),(0,s.jsx)(m.Z,{label:"删除",children:(0,s.jsx)(v.Z,{children:(0,s.jsx)(j.qy0,{})})}),(0,s.jsx)(m.Z,{label:"标注预期答案",children:(0,s.jsx)(v.Z,{onClick:B,children:(0,s.jsx)(f.lJM,{})})}),(0,s.jsx)(m.Z,{label:"给本次回答打个分",children:(0,s.jsx)(v.Z,{children:(0,s.jsx)(y.Q$h,{})})})]})}),"mermaid"===e.type&&function(e){let{code:r}=e;return R.N.parse(r)}(e.response.mermaid)?(0,s.jsx)(D,{PrimitiveCode:e.response.mermaid}):"image"===e.type?(0,s.jsx)(P(),{src:e.url,alt:"image",width:e.width||600,height:e.height||600}):(0,s.jsxs)("div",{className:"bg-pink-100 rounded-lg shadow-[0_2px_2px_2px_rgba(244,114,182,0.3)] text-sm mt-3 px-2 py-2",children:[(0,s.jsx)(u.Z,{children:e.content}),(0,s.jsxs)(d.k,{alignItems:"center",mt:"4",flexWrap:"wrap",gap:"2",children:[(0,s.jsx)(m.Z,{label:"本次回答所关联的上下文对数",children:(0,s.jsx)(c.Z,{text:"".concat(e.response.history?e.response.history.length:0,"对上下文")})}),(0,s.jsx)(m.Z,{label:"知识库中的引用",children:(0,s.jsx)(c.Z,{text:"".concat(e.response.retrieval?e.response.retrieval.sources_len:0,"条引用"),onClick:()=>{Q(e.response.retrieval.sources),O(!0)}})}),(0,s.jsx)(m.Z,{label:"本次请求总共使用的token数量",children:(0,s.jsx)(c.Z,{text:"".concat(e.response.usage?e.response.usage.total_tokens:0," tokens")})}),(0,s.jsx)(m.Z,{label:"本次请求所用时间",children:(0,s.jsx)(c.Z,{text:"".concat(e.response.time_cost?e.response.time_cost.total:"0s")})}),e.response.retrieval&&e.response.retrieval.MultiQueryRetriever&&(0,s.jsx)(m.Z,{label:"MultiQueryRetriever",children:(0,s.jsx)(c.Z,{text:"MultiQueryRetriever",onClick:()=>{Q(e.response.retrieval.MultiQueryRetriever),O(!0)}})}),(0,s.jsx)(m.Z,{label:"点击查看完整响应",children:(0,s.jsx)(c.Z,{text:"完整响应",onClick:()=>{z(e.response),x(!0)}})})]})]})]})]},e.id)})})}),o&&(0,s.jsxs)(w.u_,{isOpen:!0,onClose:()=>x(!1),children:[(0,s.jsx)(_.Z,{}),(0,s.jsxs)(k.h,{children:[(0,s.jsx)(Z.x,{children:"完整响应"}),(0,s.jsx)(C.o,{}),(0,s.jsx)(N.f,{children:(0,s.jsx)("div",{className:"border bg-orange-50 px-2 py-3",children:(0,s.jsx)(I.Z,{src:E,theme:"atom"})})}),(0,s.jsx)(S.m,{children:(0,s.jsx)(p.z,{border:"1px",borderColor:"gray.200",onClick:()=>x(!1),children:"关闭"})})]})]}),T&&(0,s.jsxs)(w.u_,{isOpen:!0,onClose:()=>A(!1),children:[(0,s.jsx)(_.Z,{}),(0,s.jsxs)(k.h,{children:[(0,s.jsx)(Z.x,{children:"请输入期望的答案"}),(0,s.jsx)(C.o,{}),(0,s.jsx)(N.f,{children:(0,s.jsx)("textarea",{className:"h-64 border bg-orange-50 w-full",placeholder:"请输入期望的答案......"})}),(0,s.jsx)(S.m,{children:(0,s.jsx)(p.z,{border:"1px",borderColor:"gray.200",onClick:()=>A(!1),children:"确认"})})]})]}),L&&(0,s.jsxs)(w.u_,{isOpen:!0,onClose:()=>O(!1),children:[(0,s.jsx)(_.Z,{}),(0,s.jsxs)(k.h,{children:[(0,s.jsx)(Z.x,{children:"详细数据"}),(0,s.jsx)(C.o,{}),(0,s.jsx)(N.f,{children:(0,s.jsx)("div",{className:"border bg-orange-50 px-2 py-3",children:(0,s.jsx)(I.Z,{src:H,theme:"atom"})})}),(0,s.jsx)(S.m,{children:(0,s.jsx)(p.z,{border:"1px",borderColor:"gray.200",onClick:()=>O(!1),children:"确认"})})]})]})]})}var L=t(13650);async function O(e){let r={method:"POST",headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("Authorization")},body:JSON.stringify(e)},t=await (0,L.d)("/ai/llm/chat/chart",r);if(t)return t}function H(e){let{appInfo:r,chat_id:t,chat_name:a}=e,[i,u]=(0,n.useState)([]),[h,p]=(0,n.useState)(!1);async function m(){let e=await (0,l.sr)(t);e&&e.length&&u(e)}(0,n.useEffect)(()=>{m()},[]);let g=e=>{u(r=>[...r,e])},j=e=>{u(r=>[...r.slice(0,-1),e])};async function b(e){let s={id:(0,x.Z)(),role:"user",type:"text",content:e};g(s),p(!0);let n={id:(0,x.Z)(),role:"assistant",type:"text",content:"正在思考中...",response:{}};g(n);let a=await O({app_id:r.id,chat_id:t,uid:s.id,answer_uid:n.id,prompt:s.content,model_name:r.llm_name});p(!1),j({id:n.id,role:n.role,type:"mermaid",content:a.answer,response:a})}return(0,s.jsxs)("div",{className:"w-full relative",children:[(0,s.jsx)("div",{className:"h-[64px] px-6 py-5",children:(0,s.jsxs)(d.k,{gap:3,children:[(0,s.jsx)("div",{children:a}),(0,s.jsx)(c.Z,{text:i.length+"条记录"})]})}),(0,s.jsx)("div",{className:"h-[1px] w-full bg-gray-200"}),i.length&&(0,s.jsx)(M,{messageList:i,stream_generate:b,waitingReply:h}),(0,s.jsx)(o.Z,{stream_generate:b})]})}function Q(e){let{appInfo:r}=e,t=(0,i.p)(),[o,c]=(0,n.useState)([]),[d,x]=(0,n.useState)(null);async function u(){let e=await (0,l.KD)(r.id);e&&e.length>0?(c(e),x(e[0].id)):(c([]),x(null))}async function h(){let e=await (0,l.JR)(r.id);e?e.errmsg?t({title:"失败",description:e.errmsg,status:"error",position:"top",duration:2e3}):t({title:"成功",status:"success",position:"top",duration:2e3}):t({title:"失败",status:"error",position:"top",duration:2e3}),await u()}async function p(e){let r=await (0,l.PW)(e);r?r.errmsg?t({title:"删除失败",description:r.errmsg,status:"error",position:"top",duration:2e3}):t({title:"删除成功",status:"success",position:"top",duration:2e3}):t({title:"删除失败",status:"error",position:"top",duration:2e3}),await u()}return(0,n.useEffect)(()=>{u()},[]),(0,s.jsx)("div",{className:"flex h-full",style:{maxHeight:"calc(100vh - 68px)",minHeight:"calc(100vh - 76px)"},children:(0,s.jsxs)("div",{className:"flex flex-1 border border-gray-200 bg-white rounded-3xl mt-1 mr-2 ml-2 mb-2 overflow-y-auto h-full",children:[(0,s.jsx)(a.Z,{appName:r.name,chatList:o,selectChatId:d,setSelectChatId:x,newChat:h,deleteChat:p}),(0,s.jsx)("div",{className:"w-[1px] h-full bg-gray-200"}),d&&(0,s.jsx)(H,{appInfo:r,chat_id:d,chat_name:o.length&&o.filter(e=>e.id===d)[0].name||"新对话"})]})})}},32376:function(e,r,t){"use strict";var s=t(57437);t(2265),r.Z=e=>{let{children:r,...t}=e;return(0,s.jsx)("div",{className:"bg-gray-50 border rounded-lg border-gray-100 shadow-[0_0_1px_1px_rgba(0,0,0,0.1)] px-0.5 py-0.5 hover:bg-orange-50 hover:text-red-400",...t,children:r})}},6806:function(e,r,t){"use strict";t.d(r,{Z:function(){return c}});var s=t(57437),n=t(72279),a=t(89348),l=t(88920),i=t(45470),o=t(2265);function c(e){let{stream_generate:r}=e,[t,c]=(0,o.useState)("");return(0,s.jsx)("div",{className:"absolute bottom-6 inset-x-0",children:(0,s.jsx)("div",{className:"w-full max-w-4xl mx-auto flex flex-col items-center px-4 space-y-4",children:(0,s.jsxs)("div",{className:"flex items-end w-full border border-back/10 bg-blue-100 rounded-lg shadow-[0_0_15px_rgba(0,0,0,0.1)] py-2",children:[(0,s.jsx)("div",{className:"mx-3 mb-2.5",children:(0,s.jsx)(a.RHh,{})}),(0,s.jsx)(i.Z,{className:"outline-none flex-1 max-h-64 mb-1.5 bg-transparent text-black resize-none border-0",placeholder:"输入一条消息...",rows:1,value:t,maxLength:32768,onKeyDown:function(e){e.metaKey&&"Enter"===e.code?c(t+"\n"):"Enter"===e.code&&t&&(r(t),c(""))},onChange:e=>{"\n"!==e.target.value&&c(e.target.value)}}),(0,s.jsx)(n.Z,{className:"mx-3 !rounded-lg text-blue-500",icon:l.LbG,disabled:""===t.trim(),variant:"primary",onClick:()=>r(t)})]})})})}},81768:function(e,r,t){"use strict";t.d(r,{Z:function(){return y}});var s=t(57437),n=t(211),a=t(26621),l=t(30954),i=t(76526),o=t(72647),c=t(3391),d=t(81629),x=t(4159),u=t(88610),h=t(71504),p=t(89348),m=t(52410),g=t(8574),j=t(19734),b=t(73623),f=t(2265);function y(e){let{appName:r,chatList:t,selectChatId:y,setSelectChatId:v,newChat:w,deleteChat:_}=e,k=(0,b.p)(),[Z,C]=(0,f.useState)(!1),[N,S]=(0,f.useState)(null);async function I(){_(N),C(!1)}return(0,s.jsxs)("div",{className:"w-[256px] rounded-l-3xl px-6 py-6",children:[(0,s.jsxs)(a.k,{alignItems:"center",children:[(0,s.jsx)("div",{className:"text-3xl border rounded-lg border-gray-100 shadow-[2px_2px_2px_2px_rgba(0,0,0,0.2)]",children:(0,s.jsx)(n.Cp6,{})}),(0,s.jsx)("div",{className:"ml-4",children:r})]}),(0,s.jsx)(a.k,{alignItems:"center",mt:12,children:(0,s.jsx)("button",{onClick:w,className:"w-full border rounded-lg border-gray-100 shadow-[0_0_2px_2px_rgba(0,0,0,0.1)] px-4 py-1 hover:text-pink-400 hover:bg-pink-100",children:(0,s.jsxs)(a.k,{alignItems:"center",textAlign:"center",justifyContent:"center",children:[(0,s.jsx)(p.Sjn,{}),(0,s.jsx)("span",{className:"ml-2",children:"新对话"})]})})}),(0,s.jsx)(a.k,{alignItems:"center",mt:6,direction:"column",children:t.map(e=>(0,s.jsx)("button",{className:"".concat(y===e.id?"shadow-[0_0_1px_1px_rgba(244,114,182,0.2)] text-pink-400 bg-pink-100":"hover:text-pink-300 hover:bg-blue-100"," w-full rounded-lg px-2 py-2 mt-4"),onClick:()=>v(e.id),children:(0,s.jsxs)(a.k,{position:"relative",alignItems:"center",children:[(0,s.jsx)(p.Sjn,{className:"ml-2"}),(0,s.jsx)("span",{className:"ml-2 max-w-[96px] truncate overflow-hidden",children:e.name||"新对话"}),(0,s.jsx)("div",{onClick:r=>{e.id,r.stopPropagation(),k({title:"该功能正在实现中，请稍等...",status:"warning",position:"top",duration:2e3})},className:"absolute right-2",children:(0,s.jsx)(j.Z,{label:e.isTopping?"取消置顶":"置顶",children:(0,s.jsx)(g.HYc,{})})}),(0,s.jsx)("div",{onClick:r=>{var t;t=e.id,r.stopPropagation(),C(!0),S(t)},className:"absolute -right-2 -top-2 text-sm hover:text-red-600",children:(0,s.jsx)(m.j7p,{})})]})},e.id))}),Z&&(0,s.jsxs)(l.u_,{isOpen:!0,onClose:()=>C(!1),children:[(0,s.jsx)(i.Z,{}),(0,s.jsxs)(o.h,{children:[(0,s.jsx)(c.x,{children:"确认删除该聊天记录吗？"}),(0,s.jsx)(d.o,{}),(0,s.jsx)(x.f,{children:(0,s.jsx)("div",{className:"text-center",children:"删除后数据将无法恢复"})}),(0,s.jsx)(u.m,{children:(0,s.jsx)(h.z,{border:"1px",borderColor:"gray.200",onClick:I,children:"确认删除"})})]})]})]})}},37600:function(e,r,t){"use strict";var s=t(57437);t(2265),r.Z=e=>{let{text:r,...t}=e;return(0,s.jsx)("div",{className:"rounded border border-solid border-red-400 text-red-400 text-center text-xs px-1.5 py-0.5",...t,children:r})}},19734:function(e,r,t){"use strict";var s=t(57437);t(2265);var n=t(14348);r.Z=e=>{let{children:r,shouldWrapChildren:t=!0,...a}=e;return(0,s.jsx)(n.u,{fontSize:12,bg:"white",arrowShadowColor:"rgba(0,0,0,0.02)",hasArrow:!0,arrowSize:12,offset:[-15,15],color:"gray.900",px:3,py:2,borderRadius:"8px",whiteSpace:"pre-wrap",boxShadow:"2px 2px 10px rgba(0,0,0,0.2)",shouldWrapChildren:t,...a,children:r})}},32721:function(e,r,t){"use strict";var s=t(57437),n=t(2265),a=t(49236),l=t(98809),i=t(73621),o=t(95462);r.Z=(0,n.memo)(function(e){let{children:r,className:t="",...n}=e;return(0,s.jsx)(a.U,{components:{code(e){var r;let{node:t,inline:n,className:a,children:l,...c}=e,d=/language-(\w+)/.exec(a||"");return n?(0,s.jsx)("code",{...c,className:a,children:l}):(0,s.jsx)(i.Z,{...c,style:o.Z,language:null!==(r=null==d?void 0:d[1])&&void 0!==r?r:"",PreTag:"div",children:String(l).replace(/\n$/,"")})}},remarkPlugins:[l.Z],className:"whitespace-pre-wrap markdown prose dark:prose-invert ".concat(t),...n,children:r})})},72279:function(e,r,t){"use strict";t.d(r,{Z:function(){return n}});var s=t(57437);function n(e){let{children:r,className:t="",icon:n,variant:a="default",...l}=e;return(0,s.jsxs)("button",{className:"inline-flex items-center min-w-[38px] min-h-[38px] rounded px-3 py-1.5\n            ".concat("default"===a?"text-gray-600 dark:text-gray-300 bg-gray-50 hover:bg-blue-100 dark:bg-gray-700 dark:hover:bg-gray-900":"outline"===a?"border border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300 bg-gray-50 hover:bg-gray-200 dark:bg-gray-800 dark:hover:bg-gray-700":"primary"===a?"bg-primary-500 text-gray-200 hover:bg-primary-600 hover:text-blue-600":"text-black dark:text-gray-300 bg-transparent hover:bg-gray-200 dark:hover:bg-gray-700","\n            ").concat(t),...l,children:[n&&(0,s.jsx)(n,{className:"text-lg ".concat(r?"mr-1":"")}),r]})}}}]);