"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[324],{22095:function(e,t,s){s.r(t),s.d(t,{default:function(){return I}});var n=s(57437),i=s(2265),a=s(211),r=s(26621),l=s(30954),o=s(76526),c=s(72647),d=s(3391),p=s(81629),x=s(4159),h=s(88610),u=s(71504),m=s(89348),g=s(52410),j=s(8574),f=s(19734),b=s(73623);function v(e){let{appName:t,chatList:s,selectChatId:v,setSelectChatId:w,newChat:y,deleteChat:_}=e,N=(0,b.p)(),[k,C]=(0,i.useState)(!1),[S,I]=(0,i.useState)(null);async function Z(){_(S),C(!1)}return(0,n.jsxs)("div",{className:"w-[256px] rounded-l-3xl px-6 py-6",children:[(0,n.jsxs)(r.k,{alignItems:"center",children:[(0,n.jsx)("div",{className:"text-3xl border rounded-lg border-gray-100 shadow-[2px_2px_2px_2px_rgba(0,0,0,0.2)]",children:(0,n.jsx)(a.Cp6,{})}),(0,n.jsx)("div",{className:"ml-4",children:t})]}),(0,n.jsx)(r.k,{alignItems:"center",mt:12,children:(0,n.jsx)("button",{onClick:y,className:"w-full border rounded-lg border-gray-100 shadow-[0_0_2px_2px_rgba(0,0,0,0.1)] px-4 py-1 hover:text-pink-400 hover:bg-pink-100",children:(0,n.jsxs)(r.k,{alignItems:"center",textAlign:"center",justifyContent:"center",children:[(0,n.jsx)(m.Sjn,{}),(0,n.jsx)("span",{className:"ml-2",children:"新对话"})]})})}),(0,n.jsx)(r.k,{alignItems:"center",mt:6,direction:"column",children:s.map(e=>(0,n.jsx)("button",{className:"".concat(v===e.id?"shadow-[0_0_1px_1px_rgba(244,114,182,0.2)] text-pink-400 bg-pink-100":"hover:text-pink-300 hover:bg-blue-100"," w-full rounded-lg px-2 py-2 mt-4"),onClick:()=>w(e.id),children:(0,n.jsxs)(r.k,{position:"relative",alignItems:"center",children:[(0,n.jsx)(m.Sjn,{className:"ml-2"}),(0,n.jsx)("span",{className:"ml-2 max-w-[96px] truncate overflow-hidden",children:e.name||"新对话"}),(0,n.jsx)("div",{onClick:t=>{e.id,t.stopPropagation(),N({title:"该功能正在实现中，请稍等...",status:"warning",position:"top",duration:2e3})},className:"absolute right-2",children:(0,n.jsx)(f.Z,{label:e.isTopping?"取消置顶":"置顶",children:(0,n.jsx)(j.HYc,{})})}),(0,n.jsx)("div",{onClick:t=>{var s;s=e.id,t.stopPropagation(),C(!0),I(s)},className:"absolute -right-2 -top-2 text-sm hover:text-red-600",children:(0,n.jsx)(g.j7p,{})})]})},e.id))}),k&&(0,n.jsxs)(l.u_,{isOpen:!0,onClose:()=>C(!1),children:[(0,n.jsx)(o.Z,{}),(0,n.jsxs)(c.h,{children:[(0,n.jsx)(d.x,{children:"确认删除该聊天记录吗？"}),(0,n.jsx)(p.o,{}),(0,n.jsx)(x.f,{children:(0,n.jsx)("div",{className:"text-center",children:"删除后数据将无法恢复"})}),(0,n.jsx)(h.m,{children:(0,n.jsx)(u.z,{border:"1px",borderColor:"gray.200",onClick:Z,children:"确认删除"})})]})]})]})}var w=s(65328),y=s(6806),_=s(73342),N=s(37600),k=s(51872),C=s(5523);function S(e){let{appInfo:t,chat_id:s,chat_name:a}=e,[l,o]=(0,i.useState)([]);async function c(){let e=await (0,w.sr)(s);e&&e.length&&o(e)}(0,i.useEffect)(()=>{c()},[]);let d=e=>{o(t=>[...t,e])},p=e=>{o(t=>[...t.slice(0,-1),e])};async function x(e){let n={id:(0,k.Z)(),role:"user",type:"text",content:e};d(n);let i={id:(0,k.Z)(),role:"assistant",type:"text",content:"正在思考中...",response:{}};d(i),await (0,C.L)("/ai/llm/chat",{openWhenHidden:!0,method:"POST",headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("Authorization")},body:JSON.stringify({app_id:t.id,chat_id:s,uid:n.id,answer_uid:i.id,prompt:n.content,model_name:t.llm_name}),onmessage(e){try{let t=JSON.parse(e.data);p({id:i.id,role:i.role,type:"text",content:t.answer,response:t})}catch(e){console.log(e)}},onerror(e){throw p({id:i.id,role:i.role,type:"text",content:"抱歉！服务繁忙！请稍后重试！",response:{}}),e}})}return(0,n.jsxs)("div",{className:"w-full relative",children:[(0,n.jsx)("div",{className:"h-[64px] px-6 py-5",children:(0,n.jsxs)(r.k,{gap:3,children:[(0,n.jsx)("div",{children:a}),(0,n.jsx)(N.Z,{text:l.length+"条记录"})]})}),(0,n.jsx)("div",{className:"h-[1px] w-full bg-gray-200"}),l.length&&(0,n.jsx)(_.Z,{messageList:l,stream_generate:x}),(0,n.jsx)(y.Z,{stream_generate:x})]})}function I(e){let{appInfo:t}=e,s=(0,b.p)(),[a,r]=(0,i.useState)([]),[l,o]=(0,i.useState)(null);async function c(){let e=await (0,w.KD)(t.id);e&&e.length>0?(r(e),o(e[0].id)):(r([]),o(null))}async function d(){let e=await (0,w.JR)(t.id);e?e.errmsg?s({title:"失败",description:e.errmsg,status:"error",position:"top",duration:2e3}):s({title:"成功",status:"success",position:"top",duration:2e3}):s({title:"失败",status:"error",position:"top",duration:2e3}),await c()}async function p(e){let t=await (0,w.PW)(e);t?t.errmsg?s({title:"删除失败",description:t.errmsg,status:"error",position:"top",duration:2e3}):s({title:"删除成功",status:"success",position:"top",duration:2e3}):s({title:"删除失败",status:"error",position:"top",duration:2e3}),await c()}return(0,i.useEffect)(()=>{c()},[]),(0,n.jsx)("div",{className:"flex h-full",style:{maxHeight:"calc(100vh - 68px)",minHeight:"calc(100vh - 76px)"},children:(0,n.jsxs)("div",{className:"flex flex-1 border border-gray-200 bg-white rounded-3xl mt-1 mr-2 ml-2 mb-2 overflow-y-auto h-full",children:[(0,n.jsx)(v,{appName:t.name,chatList:a,selectChatId:l,setSelectChatId:o,newChat:d,deleteChat:p}),(0,n.jsx)("div",{className:"w-[1px] h-full bg-gray-200"}),l&&(0,n.jsx)(S,{appInfo:t,chat_id:l,chat_name:a.length&&a.filter(e=>e.id===l)[0].name||"新对话"})]})})}}}]);